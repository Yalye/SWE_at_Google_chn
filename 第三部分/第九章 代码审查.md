## 第九章 代码审查

代码审查是由作者以外的其他人审查代码的过程，通常是在将代码合入代码库之前。尽管代码审查的定义很简单，但它的过程实现在整个软件行业中差异很大。一些组织有一组精选的“看门人”来审查对代码库的更改，另外一些组织将代码审查流程交给较小的团队，允许不同的团队使用不同级别的代码审查。在谷歌，本质上，每个变更在提交之前都要经过审查，每个工程师都有责任发起审查和审查变更。

代码审查通常需要一个过程和支持该过程的工具。在Google，我们使用自定义代码审查工具Critique来支持我们的流程。Critique 在 Google 是一个相当重要的工具，以致于这本书专门用一章来讲述它。本章通过在谷歌的实践代码重点介绍审查的过程，而不是特定的工具，因为这些基础比工具更古老，而且因为这些见解中的大部分都可以适用于你用于代码审查的任何工具。

代码审查的一些好处，例如在代码进入代码库之前检测代码中的错误，已经众所周知并且有些明显。然而，其他好处则比较微妙。由于 Google 的代码审查过程如此普遍和广泛，我们已经注意到许多这些更微妙的影响，包括心理影响，随着时间和规模的发展，这些心理影响为组织提供了许多好处。

### 代码审查流程
代码审查可以发生在软件开发的许多阶段。在Google，代码审查发生在将更改提交到代码库之前；这个阶段也称为提交前审查。代码审查的主要最终目标是获得另一位工程师同意此更改，届时我们将此更改标记为“对我来说看起来不错”（LGTM）来表示。我们将此LGTM当做一个必要的权限“位”（与下面提到的其他位组合）以允许提交更改。
在Google，一个典型的代码审查会经过以下步骤：
1. 用户在其工作区中对代码库进行更改。接着该作者创建更改的快照：上传到代码审查工具的补丁和相应的描述。此更改会产生与代码库之间的差异，用于评估更改了哪些代码。  
2. 作者可以使用这个初始补丁来推进自动审阅或进行自我审阅。当作者对更改的差异感到满意时，他们会将更改传递给一个或多个审阅者。这个过程会通知这些审阅者，要求他们查看和评论快照。  
3. 审阅者在代码审查工具中打开更改并在差异上发表评论。一些评论会给出明确的解决方法，而另外一些只是提供信息。
4. 作者根据反馈意见修改更改并上传新快照，然后回复给审阅者。步骤3和4可以重复多次。
5. 审阅者对更改的最新状态感到满意后，他们同意更改并通过将其标记为“对我来说看起来不错”(LGTM)来接受它。默认情况下只需要一个LGTM，尽管惯例可能会要求所有审阅者同意更改。
6. 更改标记为LGTM后，作者可以将更改提交到代码库，前提是他们解决了所有评论并且更改被审阅通过。我们将在下一节中介绍审阅通过。